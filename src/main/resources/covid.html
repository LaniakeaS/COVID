<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>Real-time epidemic information</title>

    <style type="text/css">
        .button {
            font-size: medium;
            height: max-content;
            float: left;
            margin-right: 15%;
            margin-left: 15%;
            color: white;
        }

        .oddRow {
            width: 20%;
            color: black;
            text-align: center;
            background-color: #bce2f5;
            float: left;
        }

        .evenRow {
            width: 20%;
            color: wheat;
            text-align: center;
            background-color: null;
            float: left;
        }

        .table {
            table-layout: fixed;
            border-width: 2px;
            width: 100%;
            height: 100%;
            border: solid #446da9;
            box-sizing: border-box;
        }

        .newsRow {
            width: 100%;
            color: #ec5f74;
            font-size: xx-large;
            background-color: null;
            float: left;
        }

        .summary {
            width: 100%;
            color: whitesmoke;
            font-size: medium;
            background-color: null;
            float: left;
        }
    </style>

</head>
<!--Screen head: Head for webpage-->

<body
    background="https://www.10wallpaper.com/wallpaper/1366x768/1411/Dark_Blue_Aurora-Abstract_widescreen_wallpaper_1366x768.jpg"
    style="background-size: cover;height:max-content;">
    <div id="header" style="height:100px; border:solid #002060; margin: 10px;">
        <h1 style="color: white; text-align: center;">
            Real-time epidemic information
        </h1>
    </div>
    <!--2 Buttons: world or China-->
    <div id="screen" style="height:700px; padding:10px; border:solid #cfdff7; fill: #dce8fa; box-sizing: border-box;">
        <div id="header" style="box-sizing: border-box;">
            <div id="screen_header1" type="button" class="button" style="background-color: #ff8585;">
                <h2 style="color:white; float: left; ">
                    World epidemic dynamic
                </h2>
            </div>
            <div id="screen_header2" type="button" class="button">
                <h2 style="color:white; float: left;">
                    China epidemic dynamic
                </h2>
            </div>
        </div>
        <!--Screen body: left for map, right for tables-->
        <div id="screen_body"
            style="height: 600px; width: 100%;  border: solid #446da9; float: left;box-sizing: border-box;">
            <div id="map"
                style="height:597px; width: 55%; float: left; border:solid #446da9; border-width: 2px; box-sizing: border-box;">
                <iframe id="lzc" src="http://192.168.0.8:8080/"
                    style="height: 100%; width: 100%; margin: 0px; padding: 0px;">
                </iframe>
            </div>
            <!--Table head, fixed position with solid border-->
            <div id="table" style="width: 45%; float: left; box-sizing: border-box;">
                <table
                    style="border-width: 2px; height:50px; width: 100%; border: solid #446da9;box-sizing: border-box;">
                    <!--5 columns: Area, new confirmed, total confirmed, total deaths and total recover-->
                    <tr>
                        <!--"country" will change according to buttons, implemented in JS-->
                        <th id="country" style="width:20%; color: white; background-color: #58b6e5;">Country</th>
                        <th id="currentConfirmed" style="width:19%; color: white; background: #f7bcaf">Current Confirmed
                        </th>
                        <th id="totalConfirmed" style="width:20%; color: white; background: #ec5f74">Total Confirmed
                        </th>
                        <th id="totalDeaths" style="width:20%; color: white; background: #d8d8">Total Deaths</th>
                        <th id="totalRec" style="width:19%; color: white; background:#8edbb8">Total Recovery</th>
                        <th style="width:5%; color: white; background:#5b6890"></th>
                    </tr>
                </table>
                <!--Table are written by JS-->
                <div id="content_div" style="height: 548px; overflow: auto; box-sizing: border-box;">
                    <table id="table_content" class="table"></table>
                </div>
            </div>
        </div>
    </div>
    <!--News are written by JS-->
    <div id="news"
        style="margin-top:10px; box-sizing: border-box; height:120px; width: 100%; border: solid #002060; fill: #dce8fa; overflow: auto;">
    </div>
    <script>
        var world = document.getElementById('screen_header1');
        var china = document.getElementById('screen_header2');
        var map = document.getElementById('lzc');

        //The first table head, as mentioned before, Area
        var area = document.getElementById('country');
        var content = document.getElementById('table_content');
        var news = document.getElementById('news');

        //Json file of data url
        var World_url = "world.json";
        var China_url = "China.json";
        var News_url = "news.json";
        var World_News_url = "worldnews.json";

        //request for table and news
        var request = new XMLHttpRequest();
        var news_request = new XMLHttpRequest();

        //Stored json file
        var json;
        var news_json;

        //Flags about whether the button is clicked
        var flag1 = true;
        var flag2 = false;

        //Function as the page be created
        window.onload = function () {
            News();
            table();
        }

        //world button
        world.onclick = function () {
            if (flag1) {
                world.style.backgroundColor = null;
                china.style.backgroundColor = '#ff8585';
                flag1 = false;
                flag2 = true;
                News();
                table();
            } else {
                world.style.backgroundColor = '#ff8585';
                china.style.backgroundColor = null;
                flag1 = true;
                flag2 = false;
                News();
                table();
            }
        }

        //Chian button
        china.onclick = function () {
            if (flag2) {
                world.style.backgroundColor = '#ff8585';
                china.style.backgroundColor = null;
                flag1 = true;
                flag2 = false;
                News();
                table();

            } else {
                world.style.backgroundColor = null;
                china.style.backgroundColor = '#ff8585';
                flag1 = false;
                flag2 = true;
                News();
                table();
            }
        }

        //Remove all old rows when new button is clicked
        function removeAllRows() {
            var children = content.childNodes;
            for (var i = children.length - 1; i >= 0; i--) {
                content.removeChild(children[i]);
            }
        }

        function removeAllNews() {
            var children = news.childNodes;
            for (var i = children.length - 1; i >= 0; i--) {
                news.removeChild(children[i]);
            }
        }

        //Input data
        function table() {
            //Remove all old rows
            removeAllRows();

            if (flag1) {
                //Change to world map url
                lzc.src = 'world map url';
                //open request
                request.open("get", World_url);
                //Change area name
                area.innerHTML = 'Country';
            } else {
                lzc.src = 'China map url';
                request.open("get", China_url);
                area.innerHTML = 'Province';
            }
            request.send(null);
            //Function once request ends
            request.onload = function () {
                //Check request status
                if (request.status == 200) {
                    //Split data
                    json = JSON.parse(request.responseText);
                    for (var i = 0; i < json.length; i++) {
                        //Create rows and content
                        var row = document.createElement("tr");
                        row.style.width = '100%';
                        var td1 = document.createElement("td1");
                        var td2 = document.createElement("td2");
                        var td3 = document.createElement("td3");
                        var td4 = document.createElement("td4");
                        var td5 = document.createElement("td5");
                        //Assign style differently
                        //Even rows
                        if (i % 2 == 0) {
                            td1.className = 'oddRow';
                            td2.className = 'oddRow';
                            td3.className = 'oddRow';
                            td4.className = 'oddRow';
                            td5.className = 'oddRow';
                        }
                        //Odd rows
                        else {
                            td1.className = 'evenRow';
                            td2.className = 'evenRow';
                            td3.className = 'evenRow';
                            td4.className = 'evenRow';
                            td5.className = 'evenRow';
                        }
                        //Append content into tables
                        td1.appendChild(document.createTextNode(json[i].provinceName));
                        td2.appendChild(document.createTextNode(json[i].currentConfirmedCount));
                        td3.appendChild(document.createTextNode(json[i].confirmedCount));
                        td4.appendChild(document.createTextNode(json[i].deadCount));
                        td5.appendChild(document.createTextNode(json[i].curedCount));
                        row.appendChild(td1);
                        row.appendChild(td2);
                        row.appendChild(td3);
                        row.appendChild(td4);
                        row.appendChild(td5);
                        content.append(row);
                    }
                }
            }
        }

        function News() {
            //Remove all news
            removeAllNews();
            //deal with request
            if (flag1) {
                news_request.open("get", World_News_url);

            } else {
                news_request.open("get", News_url);
            }
            news_request.send(null);
            news_request.onload = function () {
                //request succeed
                if (news_request.status == 200) {
                    //parse json
                    news_json = JSON.parse(news_request.responseText);
                    for (var i = 0; i < news_json.length; i++) {
                        //create news title
                        var title = document.createElement('a');
                        //append news content
                        title.innerHTML = news_json[i].title;
                        //append title url
                        title.href = news_json[i].sourceUrl;
                        title.className = 'newsRow';
                        news.append(title);
                        //summary of title
                        var summary = document.createElement('p');
                        summary.innerHTML = news_json[i].summary;
                        summary.className = 'summary';
                        news.append(summary);
                    }
                }
            }
        }
    </script>


</body>

</html>